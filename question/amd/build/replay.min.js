define(["jquery","core/ajax","core/templates","core/str","core/notification"],function(a,b,c,d,e){return{init:function(b,c,e){d.get_strings([{key:"replaydialoguetitle",component:"core_question"},{key:"warning",component:"moodle"},{key:"replaydialoguewarningmessage",component:"core_question"},{key:"continue",component:"moodle"},{key:"nostepsavailablemessage",component:"core_question"},{key:"info",component:"moodle"}]).done(a.proxy(function(a){this.dialogueTitle=a[0],this.warningTitle=a[1],this.warningMessage=a[2],this["continue"]=a[3],this.noStepsAvailableMessage=a[4],this.info=a[5]},this)),a("#"+this.escapeCss(b)).click(a.proxy(function(){this.replayResponseDialogue(c,e)},this))},getQuestionAttemptSteps:function(a){return b.call([{methodname:"core_question_get_steps",args:{questionattempt:a}}])[0]},replayResponseDialogue:function(b,d){var f=this.getQuestionAttemptSteps(b);f.done(a.proxy(function(b){var f=(new Date).getTime()/1e3,g=a.map(b.steps,function(a){return a.stepnumber<1?null:(a.elapsedMinutes=Math.floor((f-a.timecreated)/60),a)});if(g.sort(function(a,b){return a.timecreated>b.timecreated?-1:a.timecreated<b.timecreated?1:0}),0===g.length)return void e.alert(this.warningTitle,this.noStepsAvailableMessage,this["continue"]);var h={replayField:d,steps:g};c.render("core_question/replayresponse_dialoguecontent",h).done(a.proxy(function(b){var c=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,headerContent:this.dialogueTitle,bodyContent:b});a("#"+c.get("id")).on("click",'[data-action="replayStep"]',a.proxy(this.replayResponse,this)),c.show()},this))},this))},replayResponse:function(b){var c=a(b.target).data(),d=a('[name="'+c.replayfield+'"]'),f=a("#"+this.escapeCss(c.stepfield)).val();return null===f||void 0===f||""===f?void e.alert(this.warningTitle,this.warningMessage,this["continue"]):(d.val(f),void d[0].form.submit())},escapeCss:function(a){return a.replace(/(:|\.|\[|\]|,|=)/g,"\\$1")}}});